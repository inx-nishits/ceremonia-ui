<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Artifact - CeremonIA</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../../assets/images/favicon/favicon.png">
    <link rel="apple-touch-icon" href="../../assets/images/favicon/favicon.png">
        
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="../../assets/js/tailwind.config.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;1,300;1,400&family=Montserrat:wght@300;400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../../assets/css/main.css">
    <style>
        .paper-shadow {
            box-shadow: 0 4px 60px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>

<body class="bg-cream text-charcoal  flex flex-col h-screen overflow-hidden">

    <!-- Header -->
    <nav
        class="shrink-0 min-h-20 border-b border-beige bg-white flex justify-between items-center px-4 md:px-8 py-4 z-20">
        <!-- Left: Logo and Dashboard Link -->
        <div class="flex items-center gap-6">
            <a href="../../index.html" class="flex-shrink-0">
                <img src="../../assets/images/approved-logo.svg" alt="CeremonIA" class="h-12 md:h-16 w-auto">
            </a>
            <a id="dashboard-link" href="../../views/dashboard.html"
                class="bg-plum text-white  text-[10px] md:text-xs uppercase tracking-[0.2em] px-4 md:px-6 py-2 md:py-3 hover:bg-plum-light transition-colors hidden md:inline-block">
                Go to Dashboard
            </a>
        </div>

        <!-- Right: Actions -->
        <div class="flex items-center gap-2 md:gap-4">
            <button onclick="window.location.href='edit.html'"
                class=" text-[10px] md:text-xs uppercase tracking-[0.2em] border border-beige px-3 md:px-6 py-2 md:py-3 hover:border-plum hover:text-plum transition-colors">Edit</button>
            <button onclick="document.getElementById('download-modal').classList.remove('hidden')"
                class=" text-[10px] md:text-xs uppercase tracking-[0.2em] border border-beige px-3 md:px-6 py-2 md:py-3 hover:border-plum hover:text-plum transition-colors">Download</button>
            <button onclick="document.getElementById('share-modal').classList.remove('hidden')"
                class=" text-[10px] md:text-xs uppercase tracking-[0.2em] border border-beige px-3 md:px-6 py-2 md:py-3 hover:border-plum hover:text-plum transition-colors">Share</button>
            <button onclick="document.getElementById('regenerate-modal').classList.remove('hidden')"
                class=" text-[10px] md:text-xs uppercase tracking-[0.2em] border border-beige px-3 md:px-6 py-2 md:py-3 hover:border-plum hover:text-plum transition-colors">Regenerate</button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow bg-cream overflow-y-auto p-4 md:p-8 lg:p-16">
        <div class="max-w-4xl mx-auto mb-6 md:mb-8">
            <h1 class="font-goldney text-3xl md:text-4xl text-charcoal mb-3 md:mb-4">Your Ceremony Text</h1>
            <p class=" text-sm text-taupe mb-6">Review the generated script below. You can download, share
                or regenerate it.</p>

            <!-- Selected Tone and Writing Style Display -->
            <div class="flex flex-wrap items-center gap-4 mb-6 p-4 bg-lavender border-l-4 border-plum">
                <div>
                    <span class=" text-xs uppercase tracking-[0.2em] text-taupe block mb-1">Tone</span>
                    <span id="selected-tone" class="font-goldney text-lg text-charcoal">Romantic</span>
                </div>
                <div class="w-px h-8 bg-plum"></div>
                <div>
                    <span class=" text-xs uppercase tracking-[0.2em] text-taupe block mb-1">Writing
                        Style</span>
                    <span id="selected-writing-style" class="font-goldney text-lg text-charcoal">Poetic &
                        Lyrical</span>
                </div>
            </div>

            <div class="flex items-center justify-between gap-4 mb-6">
                <h2 class=" text-sm uppercase tracking-[0.2em] text-taupe">Story Preview</h2>
                <button id="toggle-story-btn" onclick="toggleStory()"
                    class=" text-xs uppercase tracking-[0.2em] border border-beige px-4 py-2 hover:border-plum hover:text-plum transition-colors">Show</button>
            </div>
        </div>
        <div class="flex justify-center">

            <article id="story-content"
                class="w-full max-w-[800px] bg-white min-h-[1200px] p-12 md:p-24 paper-shadow text-charcoal hidden">

                <!-- Branding on Paper -->
                <div class="text-center mb-24">
                    <span class="block  text-xs uppercase tracking-[0.3em] text-taupe mb-4">Celebration
                        of Union</span>
                    <h1 class="font-goldney text-6xl md:text-7xl mb-4">Sarah & James</h1>
                    <span class="block w-8 h-px bg-text-main mx-auto"></span>
                </div>

                <!-- Content -->
                <div class="space-y-16">

                    <!-- Editable Section -->
                    <div class="group relative pl-8 border-l border-transparent hover:border-plum/30 transition-colors cursor-pointer"
                        onclick="window.location.href='edit.html'">
                        <div class="absolute -left-16 top-0 opacity-0 group-hover:opacity-100 transition-opacity">
                            <span class="text-xs uppercase tracking-wide-caps bg-plum text-white px-2 py-1">Edit</span>
                        </div>
                        <h2 class="font-goldney text-3xl italic mb-6 text-charcoal">The Opening</h2>
                        <p class="font-goldney text-xl leading-loose text-taupe">
                            Friends and family, we are gathered here today to witness and celebrate the union of Sarah
                            and James. In this quiet moment, amidst the noise of the world, we pause to honor something
                            simple yet profound: two people choosing each other.
                        </p>
                    </div>

                    <!-- Editable Section -->
                    <div class="group relative pl-8 border-l border-transparent hover:border-plum/30 transition-colors cursor-pointer"
                        onclick="window.location.href='edit.html'">
                        <div class="absolute -left-16 top-0 opacity-0 group-hover:opacity-100 transition-opacity">
                            <span
                                class="text-[10px] uppercase tracking-wide-caps bg-plum text-white px-2 py-1">Edit</span>
                        </div>
                        <h2 class="font-goldney text-3xl italic mb-6 text-charcoal">The Story</h2>
                        <p class="font-goldney text-xl leading-loose text-taupe">
                            They say timing is everything. For Sarah and James, time stopped on a rainy Tuesday. It
                            wasn't fireworks or thunder; it was a conversation that felt like coming home. Over the
                            years, that initial spark has grown into a steady flame—one that warms not just them, but
                            everyone lucky enough to know them.
                        </p>
                    </div>

                </div>

                <div class="mt-32 text-center">
                    <span class="font-goldney italic text-taupe">End of Ceremony</span>
                </div>

            </article>

            <!-- Story Hidden State -->
            <div id="story-hidden"
                class="w-full max-w-[800px] bg-white min-h-[600px] p-12 md:p-24 paper-shadow text-charcoal flex flex-col items-center justify-center">
                <div class="text-center">
                    <p class=" text-sm text-taupe">Ceremony text is hidden.</p>
                    <p class=" text-sm text-taupe mt-2">Click the toggle button to reveal.</p>
                </div>
            </div>
        </div>
    </main>

    <!-- SHARE MODAL -->
    <div id="share-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
        <div class="absolute inset-0 bg-text-main/80 backdrop-blur-sm"
            onclick="this.parentElement.classList.add('hidden')"></div>
        <div class="bg-white p-12 w-full max-w-md relative z-10 animate-[fadeInUp_0.3s_ease-out] shadow-2xl">
            <button onclick="this.parentElement.parentElement.classList.add('hidden')"
                class="absolute top-6 right-6 text-2xl hover:rotate-90 transition-transform">×</button>
            <h3 class="font-goldney text-4xl mb-2">Send Ceremony via Email</h3>
            <p class=" text-sm text-taupe mb-8">Choose file format and enter the recipient's email address
            </p>

            <form onsubmit="handleShare(event)" class="space-y-6">
                <div>
                    <label class="block  text-sm text-charcoal mb-3">Select File Format</label>
                    <div class="space-y-3">
                        <label
                            class="flex items-center cursor-pointer p-3 border border-beige rounded hover:bg-cream transition-colors">
                            <input type="radio" name="shareFormat" value="pdf" checked
                                class="mr-3 w-4 h-4 text-plum border-beige focus:ring-accent-plum">
                            <span class=" text-sm text-charcoal">PDF</span>
                        </label>
                        <label
                            class="flex items-center cursor-pointer p-3 border border-beige rounded hover:bg-cream transition-colors">
                            <input type="radio" name="shareFormat" value="word"
                                class="mr-3 w-4 h-4 text-plum border-beige focus:ring-accent-plum">
                            <span class=" text-sm text-charcoal">Word (.docx)</span>
                        </label>
                    </div>
                </div>
                <div>
                    <label class="block  text-sm text-charcoal mb-3">Recipient Email Address</label>
                    <input type="email" id="share-email" placeholder="Enter Email Address" required
                        class="w-full bg-transparent border-b border-beige py-3 focus:border-plum outline-none ">
                </div>
                <div class="flex justify-end">
                    <button type="submit"
                        class="bg-text-main text-white py-4 px-12  uppercase tracking-[0.2em] text-xs hover:bg-plum transition-colors">Send
                        Email</button>
                </div>
            </form>
        </div>
    </div>

    <!-- DOWNLOAD MODAL -->
    <div id="download-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
        <div class="absolute inset-0 bg-text-main/80 backdrop-blur-sm"
            onclick="this.parentElement.classList.add('hidden')"></div>
        <div
            class="bg-white p-12 w-full max-w-sm relative z-10 text-center animate-[fadeInUp_0.3s_ease-out] shadow-2xl">
            <button onclick="this.parentElement.parentElement.classList.add('hidden')"
                class="absolute top-6 right-6 text-2xl hover:rotate-90 transition-transform">×</button>
            <h3 class="font-goldney text-3xl mb-4">Download Story</h3>
            <p class=" text-sm text-taupe mb-8 text-center leading-relaxed">
                Your ceremony story will be expected as a PDF/Word file in its current version. Would you like to
                proceed?
            </p>
            <div class="space-y-4 mb-6">
                <button onclick="handleDownload('pdf')"
                    class="w-full py-4 border border-beige hover:bg-text-main hover:text-white transition-colors uppercase tracking-[0.2em] text-xs ">Download
                    as PDF</button>
                <button onclick="handleDownload('word')"
                    class="w-full py-4 border border-beige hover:bg-text-main hover:text-white transition-colors uppercase tracking-[0.2em] text-xs ">Download
                    to Word (.docx)</button>
            </div>
            <button onclick="document.getElementById('download-modal').classList.add('hidden')"
                class="w-full py-3 border border-beige hover:bg-cream transition-colors uppercase tracking-[0.2em] text-xs  text-taupe">Cancel</button>
        </div>
    </div>

    <!-- REGENERATE MODAL -->
    <div id="regenerate-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
        <div class="absolute inset-0 bg-text-main/80 backdrop-blur-sm"
            onclick="this.parentElement.classList.add('hidden')"></div>
        <div class="bg-white p-12 w-full max-w-lg relative z-10 animate-[fadeInUp_0.3s_ease-out] shadow-2xl">
            <button onclick="this.parentElement.parentElement.classList.add('hidden')"
                class="absolute top-6 right-6 text-2xl hover:rotate-90 transition-transform">×</button>
            <h3 class="font-goldney text-3xl mb-2 text-center">Improve Ceremony Text</h3>

            <p class=" text-sm text-taupe mb-4 text-center leading-relaxed">
                Share your feedback to help improve the ceremony text. Your original answers cannot be changed.
            </p>

            <!-- Warning Note -->
            <div class="bg-cream border-l-4 border-plum p-4 mb-8">
                <p class=" text-xs text-charcoal leading-relaxed">
                    <strong>Note:</strong> Regenerating the ceremony text will permanently replace the current version.
                </p>
            </div>

            <form onsubmit="handleRegenerate(event)" class="space-y-6">
                <!-- Star Rating (Required) -->
                <div>
                    <label class="block  text-sm text-charcoal mb-3">
                        Rate this Ceremony Text <span class="text-red-600">*</span>
                    </label>
                    <div class="flex gap-2" id="star-rating">
                        <button type="button" onclick="setRating(1)"
                            class="star-btn text-3xl text-beige hover:text-plum transition-colors">★</button>
                        <button type="button" onclick="setRating(2)"
                            class="star-btn text-3xl text-beige hover:text-plum transition-colors">★</button>
                        <button type="button" onclick="setRating(3)"
                            class="star-btn text-3xl text-beige hover:text-plum transition-colors">★</button>
                        <button type="button" onclick="setRating(4)"
                            class="star-btn text-3xl text-beige hover:text-plum transition-colors">★</button>
                        <button type="button" onclick="setRating(5)"
                            class="star-btn text-3xl text-beige hover:text-plum transition-colors">★</button>
                    </div>
                    <input type="hidden" id="rating-value" required>
                </div>

                <!-- Text Feedback (Required) -->
                <div>
                    <label class="block  text-sm text-charcoal mb-3">
                        What would you like to improve? <span class="text-red-600">*</span>
                    </label>
                    <textarea id="regenerate-feedback"
                        placeholder="For Example: Make it more emotional, shorten the opening, improve the closing vows..."
                        required
                        class="w-full min-h-[150px] p-4 bg-cream border border-beige focus:border-plum  resize-none rounded"></textarea>
                </div>

                <!-- Optional: Download & Regenerate -->
                <div>
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" id="download-before-regenerate"
                            class="mr-3 w-4 h-4 text-plum border-beige rounded focus:ring-accent-plum">
                        <span class=" text-sm text-taupe">Download & Regenerate the Text</span>
                    </label>
                </div>

                <div class="flex justify-end">
                    <button type="submit"
                        class="bg-text-main text-white py-4 px-12  uppercase tracking-[0.2em] text-xs hover:bg-plum transition-colors">Regenerate
                        Ceremony Text</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Booking CTA (End Users Only) -->
    <div id="booking-cta" class="fixed bottom-8 right-8 bg-plum text-white p-6 shadow-2xl max-w-sm hidden">
        <h3 class="font-goldney text-2xl mb-2">Need an Officiant?</h3>
        <p class=" text-xs mb-4 leading-relaxed">Book a professional officiant to perform your ceremony.</p>
        <a href="#" target="_blank"
            class="inline-block bg-white text-plum  text-xs uppercase tracking-[0.2em] px-6 py-3 hover:bg-cream transition-colors">
            Book Officiant
        </a>
    </div>

    <script src="../../assets/js/mock-data.js"></script>
    <script>
        // Load and display mock story content
        function loadStoryContent() {
            const story = window.mockData ? window.mockData.getMockStory() : null;
            if (!story) return;

            // Update ceremony title
            const titleElement = document.querySelector('h1');
            if (titleElement) {
                titleElement.textContent = story.title || 'Your Ceremony Text';
            }

            // Update story sections
            const storyContent = document.getElementById('story-content');
            if (storyContent && story.sections) {
                let sectionsHTML = `
                    <!-- Branding on Paper -->
                    <div class="text-center mb-24">
                        <span class="block  text-xs uppercase tracking-[0.3em] text-taupe mb-4">Celebration of Union</span>
                        <h1 class="font-goldney text-6xl md:text-7xl mb-4">${story.coupleNames || 'The Couple'}</h1>
                        <span class="block  text-sm text-taupe mb-2">${story.date || ''}</span>
                        <span class="block w-8 h-px bg-text-main mx-auto"></span>
                    </div>

                    <!-- Content -->
                    <div class="space-y-16">
                `;

                story.sections.forEach((section, index) => {
                    sectionsHTML += `
                        <!-- Editable Section -->
                        <div class="group relative pl-8 border-l border-transparent hover:border-plum/30 transition-colors cursor-pointer"
                            onclick="window.location.href='edit.html'">
                            <div class="absolute -left-16 top-0 opacity-0 group-hover:opacity-100 transition-opacity">
                                <span class="text-xs uppercase tracking-wide-caps bg-plum text-white px-2 py-1">Edit</span>
                            </div>
                            <h2 class="font-goldney text-3xl italic mb-6 text-charcoal">${section.title}</h2>
                            <p class="font-goldney text-xl leading-loose text-taupe">
                                ${section.content}
                            </p>
                        </div>
                    `;
                });

                sectionsHTML += `
                    </div>

                    <div class="mt-32 text-center">
                        <span class="font-goldney italic text-taupe">End of Ceremony</span>
                    </div>
                `;

                storyContent.innerHTML = sectionsHTML;
            }
        }

        // Story Toggle
        function toggleStory() {
            const storyContent = document.getElementById('story-content');
            const storyHidden = document.getElementById('story-hidden');
            const toggleBtn = document.getElementById('toggle-story-btn');

            if (storyContent.classList.contains('hidden')) {
                storyContent.classList.remove('hidden');
                storyHidden.classList.add('hidden');
                toggleBtn.textContent = 'Hide';
            } else {
                storyContent.classList.add('hidden');
                storyHidden.classList.remove('hidden');
                toggleBtn.textContent = 'Show';
            }
        }

        // Load story content on page load
        document.addEventListener('DOMContentLoaded', function () {
            loadStoryContent();
        });

        // Star Rating
        let currentRating = 0;
        function setRating(rating) {
            currentRating = rating;
            document.getElementById('rating-value').value = rating;
            const stars = document.querySelectorAll('.star-btn');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.textContent = '★';
                    star.classList.remove('text-beige');
                    star.classList.add('text-plum');
                } else {
                    star.textContent = '★';
                    star.classList.remove('text-plum');
                    star.classList.add('text-beige');
                }
            });
        }

        // Regenerate Handler
        function handleRegenerate(event) {
            event.preventDefault();
            const rating = document.getElementById('rating-value').value;
            const feedback = document.getElementById('regenerate-feedback').value;
            const downloadBefore = document.getElementById('download-before-regenerate').checked;

            if (!rating || !feedback.trim()) {
                alert('Please provide both a rating and feedback.');
                return;
            }

            // Save feedback
            localStorage.setItem('regenerateRating', rating);
            localStorage.setItem('regenerateFeedback', feedback);

            // If download before regenerate is checked, trigger download
            if (downloadBefore) {
                // In real app, this would trigger download
                console.log('Downloading current version...');
            }

            // Close modal and redirect to generating
            document.getElementById('regenerate-modal').classList.add('hidden');
            window.location.href = 'generating.html';
        }

        // Download Handler
        function handleDownload(format) {
            // In real app, this would trigger download
            console.log('Downloading as', format);
            alert(`Downloading ceremony as ${format.toUpperCase()}...`);
            document.getElementById('download-modal').classList.add('hidden');
        }

        // Share Handler
        function handleShare(event) {
            event.preventDefault();
            const format = document.querySelector('input[name="shareFormat"]:checked').value;
            const email = document.getElementById('share-email').value;

            // In real app, this would send email with attachment
            console.log('Sharing', format, 'to', email);

            alert('Email sent successfully!');
            document.getElementById('share-modal').classList.add('hidden');
        }

        // Show/hide elements based on role
        document.addEventListener('DOMContentLoaded', function () {
            const userRole = localStorage.getItem('userRole');

            // Show Dashboard link only for Officiants
            const dashboardLink = document.getElementById('dashboard-link');
            if (dashboardLink) {
                if (userRole === 'officiant') {
                    dashboardLink.classList.remove('hidden');
                } else {
                    dashboardLink.classList.add('hidden');
                }
            }

            // Show booking CTA only for End Users
            if (userRole === 'endUser' || !userRole) {
                const bookingCta = document.getElementById('booking-cta');
                if (bookingCta) bookingCta.classList.remove('hidden');
            }

            // Load and display selected tone and writing style
            const selectedTone = localStorage.getItem('selectedTone');
            const selectedWritingStyle = localStorage.getItem('selectedWritingStyle');

            if (selectedTone) {
                const toneElement = document.getElementById('selected-tone');
                if (toneElement) {
                    // Capitalize and format the tone
                    const formattedTone = selectedTone.charAt(0).toUpperCase() + selectedTone.slice(1).replace(/-/g, ' & ');
                    toneElement.textContent = formattedTone;
                }
            }

            if (selectedWritingStyle) {
                const styleElement = document.getElementById('selected-writing-style');
                if (styleElement) {
                    // Format writing style
                    let formattedStyle = selectedWritingStyle.charAt(0).toUpperCase() + selectedWritingStyle.slice(1);
                    if (selectedWritingStyle === 'poetic') formattedStyle = 'Poetic & Lyrical';
                    if (selectedWritingStyle === 'narrative') formattedStyle = 'Narrative Storytelling';
                    if (selectedWritingStyle === 'simple') formattedStyle = 'Simple & Direct';
                    if (selectedWritingStyle === 'humorous') formattedStyle = 'Light & Humorous';
                    styleElement.textContent = formattedStyle;
                }
            }

            // Check generation count and update regenerate button
            checkGenerationLimit();
        });

        // Generation limit tracking
        function checkGenerationLimit() {
            const generationCount = parseInt(localStorage.getItem('generationCount') || '1');
            const maxGenerations = 5;
            const regenerateBtn = document.querySelector('button[onclick*="regenerate-modal"]');

            if (generationCount >= maxGenerations && regenerateBtn) {
                regenerateBtn.disabled = true;
                regenerateBtn.classList.add('opacity-50', 'cursor-not-allowed');
                regenerateBtn.title = 'Maximum regenerations reached (5/5)';
            }
        }

        // Override regenerate handler to check limit
        const originalHandleRegenerate = handleRegenerate;
        function handleRegenerate(event) {
            event.preventDefault();
            const generationCount = parseInt(localStorage.getItem('generationCount') || '1');
            const maxGenerations = 5;

            if (generationCount >= maxGenerations) {
                alert('You have reached the maximum number of regenerations (5). Please download your current ceremony or contact support for assistance.');
                document.getElementById('regenerate-modal').classList.add('hidden');
                return;
            }

            const rating = document.getElementById('rating-value').value;
            const feedback = document.getElementById('regenerate-feedback').value;
            const downloadBefore = document.getElementById('download-before-regenerate').checked;

            if (!rating || !feedback.trim()) {
                alert('Please provide both a rating and feedback.');
                return;
            }

            // Save feedback
            localStorage.setItem('regenerateRating', rating);
            localStorage.setItem('regenerateFeedback', feedback);

            // Increment generation count
            localStorage.setItem('generationCount', (generationCount + 1).toString());

            // If download before regenerate is checked, trigger download
            if (downloadBefore) {
                console.log('Downloading current version...');
            }

            // Close modal and redirect to generating
            document.getElementById('regenerate-modal').classList.add('hidden');
            window.location.href = 'generating.html';
        }
    </script>

</body>

</html>




